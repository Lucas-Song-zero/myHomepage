<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹ - API æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .response {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .success {
            color: #27ae60;
        }

        .error {
            color: #e74c3c;
        }

        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info strong {
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® äº”å­æ£‹ API æµ‹è¯•</h1>

        <div class="info">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong> 
            <p>1. é¦–å…ˆåˆ›å»ºæˆ¿é—´ï¼Œè®°ä¸‹æˆ¿é—´ç </p>
            <p>2. åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€æ­¤é¡µé¢ï¼Œç”¨æˆ¿é—´ç åŠ å…¥æˆ¿é—´</p>
            <p>3. åŒæ–¹å‡†å¤‡åå¼€å§‹æ¸¸æˆ</p>
        </div>

        <div class="grid">
            <!-- åˆ›å»ºæˆ¿é—´ -->
            <div class="card">
                <h2>1. åˆ›å»ºæˆ¿é—´</h2>
                <div class="form-group">
                    <label>ç©å®¶æ˜µç§°</label>
                    <input type="text" id="createName" value="ç©å®¶1" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
                </div>
                <div class="form-group">
                    <label>æ£‹ç›˜å¤§å°</label>
                    <input type="number" id="boardSize" value="15" min="15" max="19">
                </div>
                <button onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
                <div id="createResponse" class="response" style="display:none;"></div>
            </div>

            <!-- åŠ å…¥æˆ¿é—´ -->
            <div class="card">
                <h2>2. åŠ å…¥æˆ¿é—´</h2>
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="joinRoomCode" placeholder="è¾“å…¥æˆ¿é—´ç " style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>ç©å®¶æ˜µç§°</label>
                    <input type="text" id="joinName" value="ç©å®¶2" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
                </div>
                <button onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
                <div id="joinResponse" class="response" style="display:none;"></div>
            </div>

            <!-- å‡†å¤‡ -->
            <div class="card">
                <h2>3. å‡†å¤‡æ¸¸æˆ</h2>
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="readyRoomCode" placeholder="è¾“å…¥æˆ¿é—´ç " style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>ç©å®¶æ˜µç§°</label>
                    <input type="text" id="readyName" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
                </div>
                <button onclick="setReady(true)">å‡†å¤‡</button>
                <button onclick="setReady(false)" style="background: #95a5a6;">å–æ¶ˆå‡†å¤‡</button>
                <div id="readyResponse" class="response" style="display:none;"></div>
            </div>

            <!-- è·å–æˆ¿é—´ä¿¡æ¯ -->
            <div class="card">
                <h2>4. æŸ¥çœ‹æˆ¿é—´</h2>
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="getRoomCode" placeholder="è¾“å…¥æˆ¿é—´ç " style="text-transform: uppercase;">
                </div>
                <button onclick="getRoomInfo()">è·å–æˆ¿é—´ä¿¡æ¯</button>
                <button onclick="startPolling()" style="background: #27ae60;">å¼€å§‹è½®è¯¢</button>
                <button onclick="stopPolling()" style="background: #e74c3c;">åœæ­¢è½®è¯¢</button>
                <div id="getRoomResponse" class="response" style="display:none;"></div>
            </div>

            <!-- è½å­ -->
            <div class="card">
                <h2>5. è½å­</h2>
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="moveRoomCode" placeholder="è¾“å…¥æˆ¿é—´ç " style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>ç©å®¶æ˜µç§°</label>
                    <input type="text" id="moveName" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
                </div>
                <div class="form-group">
                    <label>X åæ ‡ (0-14)</label>
                    <input type="number" id="moveX" min="0" max="14" value="7">
                </div>
                <div class="form-group">
                    <label>Y åæ ‡ (0-14)</label>
                    <input type="number" id="moveY" min="0" max="14" value="7">
                </div>
                <button onclick="makeMove()">è½å­</button>
                <div id="moveResponse" class="response" style="display:none;"></div>
            </div>

            <!-- è®¤è¾“ -->
            <div class="card">
                <h2>6. è®¤è¾“</h2>
                <div class="form-group">
                    <label>æˆ¿é—´ç </label>
                    <input type="text" id="surrenderRoomCode" placeholder="è¾“å…¥æˆ¿é—´ç " style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>ç©å®¶æ˜µç§°</label>
                    <input type="text" id="surrenderName" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
                </div>
                <button onclick="surrender()" style="background: #e74c3c;">è®¤è¾“</button>
                <div id="surrenderResponse" class="response" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        let pollingInterval = null;

        function showResponse(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = 'response ' + (isError ? 'error' : 'success');
            el.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        async function createRoom() {
            try {
                const response = await fetch('/api/gomoku/rooms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        creator_name: document.getElementById('createName').value,
                        board_size: parseInt(document.getElementById('boardSize').value)
                    })
                });
                const data = await response.json();
                showResponse('createResponse', data, !response.ok);
                
                if (response.ok) {
                    // è‡ªåŠ¨å¡«å……æˆ¿é—´ç 
                    document.getElementById('readyRoomCode').value = data.room_code;
                    document.getElementById('getRoomCode').value = data.room_code;
                    document.getElementById('moveRoomCode').value = data.room_code;
                    document.getElementById('readyName').value = data.creator_name;
                    document.getElementById('moveName').value = data.creator_name;
                }
            } catch (error) {
                showResponse('createResponse', { error: error.message }, true);
            }
        }

        async function joinRoom() {
            try {
                const roomCode = document.getElementById('joinRoomCode').value.toUpperCase();
                const response = await fetch(`/api/gomoku/rooms/${roomCode}/join`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_name: document.getElementById('joinName').value
                    })
                });
                const data = await response.json();
                showResponse('joinResponse', data, !response.ok);
                
                if (response.ok) {
                    // è‡ªåŠ¨å¡«å……æˆ¿é—´ç 
                    document.getElementById('readyRoomCode').value = roomCode;
                    document.getElementById('getRoomCode').value = roomCode;
                    document.getElementById('moveRoomCode').value = roomCode;
                    document.getElementById('readyName').value = data.player_name;
                    document.getElementById('moveName').value = data.player_name;
                }
            } catch (error) {
                showResponse('joinResponse', { error: error.message }, true);
            }
        }

        async function setReady(ready) {
            try {
                const roomCode = document.getElementById('readyRoomCode').value.toUpperCase();
                const response = await fetch(`/api/gomoku/rooms/${roomCode}/ready`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_name: document.getElementById('readyName').value,
                        is_ready: ready
                    })
                });
                const data = await response.json();
                showResponse('readyResponse', data, !response.ok);
            } catch (error) {
                showResponse('readyResponse', { error: error.message }, true);
            }
        }

        async function getRoomInfo() {
            try {
                const roomCode = document.getElementById('getRoomCode').value.toUpperCase();
                const response = await fetch(`/api/gomoku/rooms/${roomCode}`);
                const data = await response.json();
                showResponse('getRoomResponse', data, !response.ok);
            } catch (error) {
                showResponse('getRoomResponse', { error: error.message }, true);
            }
        }

        async function makeMove() {
            try {
                const roomCode = document.getElementById('moveRoomCode').value.toUpperCase();
                const response = await fetch(`/api/gomoku/rooms/${roomCode}/move`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_name: document.getElementById('moveName').value,
                        x: parseInt(document.getElementById('moveX').value),
                        y: parseInt(document.getElementById('moveY').value)
                    })
                });
                const data = await response.json();
                showResponse('moveResponse', data, !response.ok);
            } catch (error) {
                showResponse('moveResponse', { error: error.message }, true);
            }
        }

        async function surrender() {
            try {
                const roomCode = document.getElementById('surrenderRoomCode').value.toUpperCase();
                const response = await fetch(`/api/gomoku/rooms/${roomCode}/surrender`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_name: document.getElementById('surrenderName').value
                    })
                });
                const data = await response.json();
                showResponse('surrenderResponse', data, !response.ok);
            } catch (error) {
                showResponse('surrenderResponse', { error: error.message }, true);
            }
        }

        function startPolling() {
            if (pollingInterval) return;
            getRoomInfo();
            pollingInterval = setInterval(getRoomInfo, 2000);
        }

        function stopPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        // é¡µé¢å¸è½½æ—¶åœæ­¢è½®è¯¢
        window.addEventListener('beforeunload', stopPolling);
    </script>
    <footer style="display:flex;justify-content:center;padding:10px 16px;background:rgba(255,255,255,0.9);border-top:1px solid rgba(0,0,0,0.06);font-size:0.85rem;">
        <a href="https://beian.mps.gov.cn/#/query/webSearch?code=11010802047067" rel="noreferrer" target="_blank" style="display:inline-flex;align-items:center;gap:8px;color:inherit;text-decoration:none">
            <img src="/static/images/police.png" alt="police" style="height:18px;display:inline-block">
            <span>äº¬å…¬ç½‘å®‰å¤‡11010802047067å·</span>
        </a>
    </footer>
</body>
</html>
