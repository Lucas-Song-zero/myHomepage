<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂçöÂÆ¢ - Ê±üÁéÆÈô∂ÁöÑ‰∏™‰∫∫‰∏ªÈ°µ</title>
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <link rel="stylesheet" href="/static/css/global.css?v=3">
    
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="highlight-theme-light">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="highlight-theme-dark" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        .container {
            max-width: 900px;
            margin: 90px auto 40px;
            padding: 0 20px;
        }

        .article-header {
            background: var(--card-bg);
            border-radius: 0;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .article-header {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .article-title {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .article-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 20px;
        }

        .article-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 6px 15px;
            border-radius: 0;
            font-size: 0.9em;
        }

        body.dark-mode .tag {
            background: rgba(102, 126, 234, 0.2);
            color: #8b9cff;
        }

        .article-content {
            background: var(--card-bg);
            border-radius: 0;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .article-content {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* MarkdownÊ†∑Âºè */
        .markdown-body {
            font-size: 16px;
            line-height: 1.8;
        }

        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3,
        .markdown-body h4,
        .markdown-body h5,
        .markdown-body h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        .markdown-body h1 {
            font-size: 2em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid rgba(128, 128, 128, 0.3);
        }

        .markdown-body h2 {
            font-size: 1.5em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid rgba(128, 128, 128, 0.3);
        }

        body.dark-mode .markdown-body h1,
        body.dark-mode .markdown-body h2 {
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }

        .markdown-body h3 { font-size: 1.25em; }
        .markdown-body h4 { font-size: 1em; }
        .markdown-body h5 { font-size: 0.875em; }
        .markdown-body h6 { font-size: 0.85em; }

        .markdown-body p {
            margin-top: 0;
            margin-bottom: 16px;
        }

        .markdown-body a {
            color: #0969da;
            text-decoration: none;
        }

        body.dark-mode .markdown-body a {
            color: #58a6ff;
        }

        .markdown-body a:hover {
            text-decoration: underline;
        }

        .markdown-body code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(175, 184, 193, 0.2);
            border-radius: 0;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
        }

        body.dark-mode .markdown-body code {
            background-color: rgba(255, 255, 255, 0.15);
        }

        .markdown-body pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: var(--card-bg);
            border-radius: 0;
            margin-bottom: 16px;
            border: 1px solid rgba(128, 128, 128, 0.2);
        }

        body.dark-mode .markdown-body pre {
            background-color: #1e1e1e;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .markdown-body pre code {
            padding: 0;
            background: transparent;
            border-radius: 0;
            font-size: 100%;
        }

        .markdown-body blockquote {
            padding: 0 1em;
            color: #57606a;
            border-left: 0.25em solid rgba(128, 128, 128, 0.3);
            margin: 0 0 16px 0;
        }

        body.dark-mode .markdown-body blockquote {
            color: #a0a0a0;
            border-left-color: rgba(255, 255, 255, 0.2);
        }

        .markdown-body img {
            max-width: 100%;
            height: auto;
            border-radius: 0;
            margin: 16px 0;
        }

        .markdown-body table {
            border-spacing: 0;
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }

        .markdown-body table th,
        .markdown-body table td {
            padding: 6px 13px;
            border: 1px solid rgba(128, 128, 128, 0.3);
        }

        body.dark-mode .markdown-body table th,
        body.dark-mode .markdown-body table td {
            border-color: rgba(255, 255, 255, 0.2);
        }

        .markdown-body table th {
            font-weight: 600;
            background-color: rgba(128, 128, 128, 0.1);
        }

        body.dark-mode .markdown-body table th {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* BÁ´ôËßÜÈ¢ë */
        .bilibili-video {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin: 20px 0;
            border-radius: 0;
            background: #000;
        }

        .bilibili-video iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* KaTeX */
        .math-block {
            display: block;
            margin: 1em 0;
            text-align: center;
        }

        .katex {
            font-size: 1.1em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 20px;
            }

            .container {
                margin-top: 80px;
            }

            .article-header,
            .article-content {
                padding: 20px;
            }

            .article-title {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <nav class="navbar">
        <a href="/" class="navbar-brand"></a>
        <ul class="navbar-menu">
            <li><a href="/index.html" title="‰∏ªÈ°µ">
                <img src="/static/images/home.png" alt="‰∏ªÈ°µ" class="nav-icon">
            </a></li>
            <li><a href="/static/notes/index.html" title="Á¨îËÆ∞">
                <img src="/static/images/note.png" alt="Á¨îËÆ∞" class="nav-icon">
            </a></li>
            <li><a href="/blog.html" title="ÂçöÂÆ¢">
                <img src="/static/images/blog.png" alt="ÂçöÂÆ¢" class="nav-icon">
            </a></li>
            <li><a href="/gomoku.html" title="‰∫îÂ≠êÊ£ã">
                <img src="/static/images/game.png" alt="‰∫îÂ≠êÊ£ã" class="nav-icon">
            </a></li>
            <li><a href="#links" title="ÂèãÈìæ">
                <img src="/static/images/friend.png" alt="ÂèãÈìæ" class="nav-icon">
            </a></li>
            <li><a href="/admin_login.html" title="ÁÆ°ÁêÜ">
                <img src="/static/images/admin.png" alt="ÁÆ°ÁêÜ" class="nav-icon">
            </a></li>
            <li><button class="theme-toggle" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">
                <img id="theme-icon" src="/static/images/moon.png" alt="ÂàáÊç¢‰∏ªÈ¢ò" class="theme-icon">
            </button></li>
        </ul>
        <div class="navbar-toggle" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="container">
        <div class="article-header" id="articleHeader"></div>
        <div class="article-content">
            <div class="markdown-body" id="content"></div>
        </div>
    </div>

    <script>
        // ‰∏ªÈ¢òÂàáÊç¢
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const lightTheme = document.getElementById('highlight-theme-light');
            const darkTheme = document.getElementById('highlight-theme-dark');
            
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            
            themeIcon.src = isDark ? '/static/images/sun.png' : '/static/images/moon.png';
            lightTheme.disabled = isDark;
            darkTheme.disabled = !isDark;
            
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('theme-icon');
            const lightTheme = document.getElementById('highlight-theme-light');
            const darkTheme = document.getElementById('highlight-theme-dark');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeIcon.src = '/static/images/sun.png';
                lightTheme.disabled = true;
                darkTheme.disabled = false;
            }
        }

        // ÂØºËà™Ê†èÊªöÂä®ÊïàÊûú
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            if (window.scrollY > 0) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // Ëé∑ÂèñURLÂèÇÊï∞
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Â§ÑÁêÜBÁ´ôËßÜÈ¢ë
        function processBilibiliLinks(html) {
            html = html.replace(/<code>(BV[a-zA-Z0-9]+)<\/code>/g, (match, bvid) => {
                return `<div class="bilibili-video">
                    <iframe src="//player.bilibili.com/player.html?isOutside=true&bvid=${bvid}&p=1&high_quality=1&danmaku=0" 
                            scrolling="no" 
                            border="0"
                            frameborder="no" 
                            framespacing="0" 
                            allowfullscreen="true">
                    </iframe>
                </div>`;
            });
            return html;
        }

        // Ê†ºÂºèÂåñÊó•Êúü
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Âä†ËΩΩÂçöÂÆ¢ÊñáÁ´†
        async function loadPost() {
            const postId = getQueryParam('id');
            
            if (!postId) {
                document.getElementById('content').innerHTML = '<div class="loading">Êú™ÊåáÂÆöÊñáÁ´†ID</div>';
                return;
            }

            try {
                const response = await fetch(`/api/blog/posts/${postId}`);
                const post = await response.json();

                if (response.status === 404) {
                    document.getElementById('content').innerHTML = '<div class="loading">ÊñáÁ´†‰∏çÂ≠òÂú®</div>';
                    return;
                }

                // ËÆæÁΩÆÊ†áÈ¢ò
                document.title = `${post.title} - ÂçöÂÆ¢`;

                // Ê∏≤ÊüìÊñáÁ´†Â§¥ÈÉ®
                const headerHTML = `
                    <h1 class="article-title">${post.title}</h1>
                    <div class="article-meta">
                        <span>üìÖ ${formatDate(post.created_at)}</span>
                        <span>‚úçÔ∏è ${post.author}</span>
                        <span>üëÅÔ∏è ${post.view_count} Ê¨°ÈòÖËØª</span>
                    </div>
                    ${post.tags.length > 0 ? `
                        <div class="article-tags">
                            ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                `;
                document.getElementById('articleHeader').innerHTML = headerHTML;

                // ‰øùÊä§Êï∞Â≠¶ÂÖ¨Âºè
                let markdown = post.content;
                const mathBlocks = [];
                const mathInlines = [];
                
                markdown = markdown.replace(/\$\$([\s\S]+?)\$\$/g, (match, formula) => {
                    const index = mathBlocks.length;
                    mathBlocks.push(formula);
                    return `MATHBLOCK${index}MATHBLOCK`;
                });
                
                markdown = markdown.replace(/\$([^\$\n]+?)\$/g, (match, formula) => {
                    const index = mathInlines.length;
                    mathInlines.push(formula);
                    return `MATHINLINE${index}MATHINLINE`;
                });

                // ÈÖçÁΩÆmarked
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: true,
                    mangle: false
                });

                // ËΩ¨Êç¢Markdown
                let html = marked.parse(markdown);

                // ÊÅ¢Â§çÊï∞Â≠¶ÂÖ¨Âºè
                html = html.replace(/MATHBLOCK(\d+)MATHBLOCK/g, (match, index) => {
                    return `<span class="math-block">$$${mathBlocks[index]}$$</span>`;
                });
                
                html = html.replace(/MATHINLINE(\d+)MATHINLINE/g, (match, index) => {
                    return `<span class="math-inline">$${mathInlines[index]}$</span>`;
                });

                // Â§ÑÁêÜBÁ´ôËßÜÈ¢ë
                html = processBilibiliLinks(html);

                // ÊèíÂÖ•HTML
                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = html;

                // ‰ª£Á†ÅÈ´ò‰∫Æ
                contentDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightBlock(block);
                });

                // Ê∏≤ÊüìKaTeX
                renderMathInElement(contentDiv, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\[', right: '\\]', display: true},
                        {left: '\\(', right: '\\)', display: false}
                    ],
                    throwOnError: false
                });

            } catch (error) {
                console.error('Âä†ËΩΩÊñáÁ´†Â§±Ë¥•:', error);
                document.getElementById('content').innerHTML = '<div class="loading">Âä†ËΩΩÂ§±Ë¥•</div>';
            }
        }

        // È°µÈù¢Âä†ËΩΩ
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadPost();
        });
    </script>
    <script src="/static/js/global.js"></script>
    <footer style="display:flex;justify-content:center;padding:10px 16px;">
        <div style="display:inline-flex;align-items:center;gap:12px">
            <span>&copy; 2025 Ê±üÁéÆÈô∂. All rights reserved. | <a href="https://github.com/CBDT-JWT/Home" target="_blank" rel="noopener noreferrer" title="GitHub">GitHub</a> | <a href="mailto:wjiang0415@outlook.com" target="_blank" rel="noopener noreferrer" title="Mail">Mail</a> | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" style="text-decoration:none;">‰∫¨ICPÂ§á2025155858Âè∑-1</a>ÔΩú<a href="https://beian.mps.gov.cn/#/query/webSearch?code=11010802047067" rel="noreferrer" target="_blank" style="display:inline-flex;align-items:center;gap:8px;color:inherit;text-decoration:none;margin-left:8px">
                <img src="/static/images/police.png" alt="police" style="height:18px;display:inline-block">‰∫¨ÂÖ¨ÁΩëÂÆâÂ§á11010802047067Âè∑ </a></span>
        </div>
    </footer>
</body>
</html>
